<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bug Demonstration - Selector Issue</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .demo-container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .demo-panel {
            flex: 1;
            background: white;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        h3 {
            margin-top: 0;
            color: #333;
        }
        .explanation {
            margin: 20px 0;
            padding: 15px;
            background: #fff3cd;
            border-left: 3px solid #ffc107;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            border-left-color: #28a745;
        }
        button {
            margin: 10px 5px;
            padding: 8px 16px;
            background: #0078d4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            opacity: 0.9;
        }
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
        .highlight-wrong {
            background: rgba(255, 0, 0, 0.1);
            border: 2px solid red;
            padding: 2px;
        }
        .highlight-correct {
            background: rgba(0, 255, 0, 0.1);
            border: 2px solid green;
            padding: 2px;
        }
    </style>
</head>
<body>
    <h1>Bug Fix Demonstration: Tree View Selection</h1>
    
    <div class="explanation">
        <h3>üêõ The Bug:</h3>
        <p>Both <code>&lt;li class="tree-node"&gt;</code> and <code>&lt;div class="tree-node-content"&gt;</code> have the same <code>data-node-id</code> attribute.</p>
        <p>The old code used: <code>querySelector('[data-node-id="..."]')</code></p>
        <p>This returns the <strong>first matching element</strong>, which is the <code>&lt;li&gt;</code>, not the <code>&lt;div&gt;</code>!</p>
        <p>The CSS applies to <code>.tree-node-content.selected</code>, but the class was being added to <code>.tree-node</code> instead.</p>
    </div>

    <div class="demo-container">
        <div class="demo-panel">
            <h3>‚ùå Before (Broken)</h3>
            <button id="select-wrong">Select Node (Wrong Way)</button>
            <ul id="tree-wrong" style="list-style: none; padding: 0; margin: 10px 0;">
                <li class="tree-node" data-node-id="1">
                    <div class="tree-node-content" data-node-id="1">
                        <span class="tree-node-icon">üåü</span>
                        <span class="tree-node-text">System: Test System</span>
                    </div>
                </li>
                <li class="tree-node" data-node-id="2">
                    <div class="tree-node-content" data-node-id="2">
                        <span class="tree-node-icon">üåç</span>
                        <span class="tree-node-text">Planet: Footfall</span>
                    </div>
                </li>
            </ul>
            <div class="explanation">
                <strong>Using:</strong> <code>querySelector('[data-node-id="2"]')</code><br>
                <strong>Selects:</strong> The <code>&lt;li&gt;</code> element<br>
                <strong>Result:</strong> ‚ùå No visible selection
            </div>
        </div>

        <div class="demo-panel">
            <h3>‚úÖ After (Fixed)</h3>
            <button id="select-right">Select Node (Fixed Way)</button>
            <ul id="tree-right" style="list-style: none; padding: 0; margin: 10px 0;">
                <li class="tree-node" data-node-id="3">
                    <div class="tree-node-content" data-node-id="3">
                        <span class="tree-node-icon">üåü</span>
                        <span class="tree-node-text">System: Test System</span>
                    </div>
                </li>
                <li class="tree-node" data-node-id="4">
                    <div class="tree-node-content" data-node-id="4">
                        <span class="tree-node-icon">üåç</span>
                        <span class="tree-node-text">Planet: Footfall</span>
                    </div>
                </li>
            </ul>
            <div class="explanation success">
                <strong>Using:</strong> <code>.tree-node-content[data-node-id="4"]</code><br>
                <strong>Selects:</strong> The <code>&lt;div class="tree-node-content"&gt;</code><br>
                <strong>Result:</strong> ‚úÖ Selection visible with blue background + border!
            </div>
        </div>
    </div>

    <div class="explanation success" style="margin-top: 20px;">
        <h3>‚ú® The Fix:</h3>
        <p>Changed the selector to specifically target <code>.tree-node-content</code>:</p>
        <p><strong>Line 172:</strong> <code>querySelector('.tree-node-content[data-node-id="${node.id}"]')</code></p>
        <p><strong>Line 227:</strong> <code>querySelector('.tree-node-content[data-node-id="${this.selectedNode.id}"]')</code></p>
        <p>This ensures the <code>.selected</code> class is added to the correct element that has the CSS styling.</p>
    </div>

    <script>
        // Simulate the bug - wrong selector
        document.getElementById('select-wrong').addEventListener('click', () => {
            // Clear any previous highlights
            document.querySelectorAll('.highlight-wrong, .highlight-correct').forEach(el => {
                el.classList.remove('highlight-wrong', 'highlight-correct');
            });
            
            // Old buggy way - selects the <li> not the <div>
            const wrongElement = document.querySelector('[data-node-id="2"]');
            if (wrongElement) {
                wrongElement.classList.add('selected');
                wrongElement.classList.add('highlight-wrong');
                
                // Show what got selected
                setTimeout(() => {
                    alert('Selected element class: ' + wrongElement.className + '\nThis is the <li>, not the <div>!\nThe .selected class has no effect here.');
                }, 100);
            }
        });

        // Demonstrate the fix - correct selector
        document.getElementById('select-right').addEventListener('click', () => {
            // Clear any previous highlights
            document.querySelectorAll('.highlight-wrong, .highlight-correct').forEach(el => {
                el.classList.remove('highlight-wrong', 'highlight-correct');
            });
            
            // Clear previous selections in this tree
            document.querySelectorAll('#tree-right .selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            // Fixed way - specifically targets .tree-node-content
            const correctElement = document.querySelector('.tree-node-content[data-node-id="4"]');
            if (correctElement) {
                correctElement.classList.add('selected');
                correctElement.classList.add('highlight-correct');
                
                // Show what got selected
                setTimeout(() => {
                    alert('Selected element class: ' + correctElement.className + '\nThis is the <div class="tree-node-content">!\nThe .selected class works correctly here.');
                }, 100);
            }
        });
    </script>
</body>
</html>
